<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–º–∏–Ω–∞—Ä—ã –∏ –ö—É—Ä—Å—ã - –•–∞–∫–∞—Ç–æ–Ω –•–∞–±</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Upper Navigation Hub -->
    <nav class="top-nav">
        <div class="nav-container">
            <button class="menu-btn" id="menuBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="logo">
                <h1>–•–∞–∫–∞—Ç–æ–Ω –•–∞–±</h1>
            </div>
            <ul class="nav-links">
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="registration.html" id="registerLink">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                <li><a href="hackathons.html">–•–∞–∫–∞—Ç–æ–Ω—ã</a></li>
                <li><a href="seminars.html" class="active">–°–µ–º–∏–Ω–∞—Ä—ã</a></li>
                <li><a href="about.html">–û –Ω–∞—Å</a></li>
                <li><a href="profile.html" id="profileLink" style="display: none;">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><a href="login.html" id="loginLink">–í—Ö–æ–¥</a></li>
                <li><a href="/" id="logoutLink" style="display: none;">–í—ã—Ö–æ–¥</a></li>
                <li><a href="expert.html" id="expertLink" style="display: none;">–ü–∞–Ω–µ–ª—å —ç–∫—Å–ø–µ—Ä—Ç–∞</a></li>
                <li><a href="admin.html" id="adminLink" style="display: none;">–ê–¥–º–∏–Ω</a></li>
            </ul>
        </div>
    </nav>

    <!-- Sidebar Hub -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –•–∞–±</h2>
            <button class="close-btn" id="closeBtn">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="hub-section" id="participantsSection">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <div class="info-card">
                    <p><strong>–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> 1,234</p>
                    <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–π—á–∞—Å:</strong> 89</p>
                    <p><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ:</strong> 156</p>
                </div>
            </div>
            <div class="hub-section" id="hackathonsSection">
                <h3>–•–∞–∫–∞—Ç–æ–Ω—ã</h3>
                <div class="info-card">
                    <p><strong>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ:</strong> 12</p>
                    <p><strong>–¢–µ–∫—É—â–∏–µ:</strong> 3</p>
                    <p><strong>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ:</strong> 45</p>
                </div>
            </div>
            <div class="hub-section" id="coursesSection">
                <h3>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –ö—É—Ä—Å—ã</h3>
                <div class="info-card">
                    <p><strong>–î–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤:</strong> 8</p>
                    <p><strong>–ó–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:</strong> 567</p>
                    <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:</strong> 78%</p>
                </div>
            </div>
            <div class="hub-section" id="organizationsSection">
                <h3>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h3>
                <div class="info-card">
                    <p><strong>–í—Å–µ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:</strong> 24</p>
                    <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤:</strong> 18</p>
                    <p><strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —Ö–∞–∫–∞—Ç–æ–Ω–æ–≤:</strong> 67</p>
                </div>
            </div>
            <div class="hub-section" id="statisticsSection">
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="info-card">
                    <p><strong>–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤:</strong> 890</p>
                    <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞:</strong> 82%</p>
                    <p><strong>–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:</strong> 4.2</p>
                    <p><strong>–ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥:</strong> $125,000</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="hero-section">
            <h2>–°–µ–º–∏–Ω–∞—Ä—ã –∏ –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –ö—É—Ä—Å—ã</h2>
            <p>–£—á–∏—Ç–µ—Å—å —É —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏ —É—Å–∫–æ—Ä—è–π—Ç–µ —Å–≤–æ—é –∫–∞—Ä—å–µ—Ä—É</p>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-btn active" data-filter="webinars">–í–µ–±–∏–Ω–∞—Ä—ã/–°–µ–º–∏–Ω–∞—Ä—ã</button>
            <button class="filter-btn" data-filter="courses">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –ö—É—Ä—Å—ã</button>
        </div>

        <!-- Webinars/Seminars Section -->
        <section class="hackathons-section" id="webinars">
            <h2 class="section-title">–í–µ–±–∏–Ω–∞—Ä—ã –∏ –°–µ–º–∏–Ω–∞—Ä—ã</h2>
            <div class="hackathons-grid" id="webinars-list">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </section>

        <!-- Intensive Courses Section -->
        <section class="hackathons-section" id="courses" style="display: none;">
            <h2 class="section-title">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –ö—É—Ä—Å—ã</h2>
            <div class="hackathons-grid" id="courses-list">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </section>
    </main>

    <script src="/static/script.js"></script>
    <script>
        let currentUser = null;

        // Update navigation on load
        if (typeof updateNavigation === 'function') {
            updateNavigation();
        }

        // Load current user
        async function loadUserData() {
            try {
                const response = await fetch('/api/user');
                if (response.ok) {
                    currentUser = await response.json();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Load webinars
        async function loadWebinars() {
            try {
                const response = await fetch('/api/webinars?status_filter=upcoming');
                const webinars = await response.json();
                renderWebinars(webinars);
            } catch (error) {
                console.error('Error loading webinars:', error);
                document.getElementById('webinars-list').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ–±–∏–Ω–∞—Ä–æ–≤</p>';
            }
        }

        function renderWebinars(webinars) {
            const container = document.getElementById('webinars-list');
            if (webinars.length === 0) {
                container.innerHTML = '<p>–í–µ–±–∏–Ω–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            container.innerHTML = webinars.map(w => {
                const date = new Date(w.date_time);
                const statusLabels = {
                    'upcoming': '–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–π',
                    'ongoing': '–ò–¥—ë—Ç —Å–µ–π—á–∞—Å',
                    'completed': '–ó–∞–≤–µ—Ä—à—ë–Ω'
                };
                const statusBadges = {
                    'upcoming': 'upcoming',
                    'ongoing': 'ongoing',
                    'completed': 'completed'
                };

                let buttonHtml = '';
                if (w.is_registered) {
                    buttonHtml = `
                        <div class="participation-info">
                            <strong>–í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã</strong>
                        </div>
                        <button class="btn btn-secondary btn-full" onclick="cancelWebinarRegistration(${w.id})">–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</button>
                    `;
                } else if (w.status === 'completed') {
                    buttonHtml = '<button class="btn btn-secondary btn-full" disabled>–ó–∞–≤–µ—Ä—à—ë–Ω</button>';
                } else if (currentUser) {
                    const isFull = w.max_participants && w.participant_count >= w.max_participants;
                    if (isFull) {
                        buttonHtml = '<button class="btn btn-secondary btn-full" disabled>–ú–µ—Å—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</button>';
                    } else {
                        buttonHtml = `<button class="btn btn-primary btn-full" onclick="registerForWebinar(${w.id})">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>`;
                    }
                } else {
                    buttonHtml = '<a href="login.html" class="btn btn-primary btn-full">–í–æ–π—Ç–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>';
                }

                return `
                    <div class="hackathon-card">
                        <div class="hackathon-badge ${statusBadges[w.status] || 'upcoming'}">${statusLabels[w.status] || '–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–π'}</div>
                        <h3>${w.name}</h3>
                        <p class="hackathon-org">–°–ø–∏–∫–µ—Ä: ${w.speaker}</p>
                        ${w.description ? `<p class="hackathon-desc">${w.description}</p>` : ''}
                        <div class="hackathon-details">
                            <div class="detail-item">
                                <span class="detail-icon">üìÖ</span>
                                <span>${date.toLocaleString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            ${w.duration_hours ? `
                            <div class="detail-item">
                                <span class="detail-icon">‚è±Ô∏è</span>
                                <span>${w.duration_hours} ${w.duration_hours === 1 ? '—á–∞—Å' : w.duration_hours < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤'}</span>
                            </div>
                            ` : ''}
                            <div class="detail-item">
                                <span class="detail-icon">üíª</span>
                                <span>${w.location || '–û–Ω–ª–∞–π–Ω'}</span>
                            </div>
                            ${w.max_participants ? `
                            <div class="detail-item">
                                <span class="detail-icon">üë•</span>
                                <span>${w.participant_count || 0} / ${w.max_participants} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                            </div>
                            ` : ''}
                        </div>
                        ${buttonHtml}
                    </div>
                `;
            }).join('');
        }

        // Load courses
        async function loadCourses() {
            try {
                const response = await fetch('/api/courses?status_filter=upcoming');
                const courses = await response.json();
                renderCourses(courses);
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('courses-list').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤</p>';
            }
        }

        function renderCourses(courses) {
            const container = document.getElementById('courses-list');
            if (courses.length === 0) {
                container.innerHTML = '<p>–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            container.innerHTML = courses.map(c => {
                const startDate = new Date(c.start_date);
                const endDate = new Date(c.end_date);
                const statusLabels = {
                    'upcoming': '–°–∫–æ—Ä–æ',
                    'ongoing': '–ò–¥—ë—Ç –Ω–∞–±–æ—Ä',
                    'completed': '–ó–∞–≤–µ—Ä—à—ë–Ω'
                };
                const statusBadges = {
                    'upcoming': 'upcoming',
                    'ongoing': 'ongoing',
                    'completed': 'completed'
                };

                let buttonHtml = '';
                if (c.is_registered) {
                    buttonHtml = `
                        <div class="participation-info">
                            <strong>–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫—É—Ä—Å</strong>
                        </div>
                        <button class="btn btn-secondary btn-full" onclick="cancelCourseRegistration(${c.id})">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    `;
                } else if (c.status === 'completed') {
                    buttonHtml = '<button class="btn btn-secondary btn-full" disabled>–ó–∞–≤–µ—Ä—à—ë–Ω</button>';
                } else if (currentUser) {
                    const isFull = c.max_students && c.participant_count >= c.max_students;
                    if (isFull) {
                        buttonHtml = '<button class="btn btn-secondary btn-full" disabled>–ú–µ—Å—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</button>';
                    } else {
                        buttonHtml = `<button class="btn btn-primary btn-full" onclick="registerForCourse(${c.id})">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å</button>`;
                    }
                } else {
                    buttonHtml = '<a href="login.html" class="btn btn-primary btn-full">–í–æ–π—Ç–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏</a>';
                }

                return `
                    <div class="hackathon-card">
                        <div class="hackathon-badge ${statusBadges[c.status] || 'upcoming'}">${statusLabels[c.status] || '–°–∫–æ—Ä–æ'}</div>
                        <h3>${c.name}</h3>
                        <p class="hackathon-org">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${c.instructor}</p>
                        ${c.description ? `<p class="hackathon-desc">${c.description}</p>` : ''}
                        <div class="hackathon-details">
                            <div class="detail-item">
                                <span class="detail-icon">üìÖ</span>
                                <span>–ù–∞—á–∞–ª–æ: ${startDate.toLocaleDateString('ru-RU')}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">üìÖ</span>
                                <span>–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${endDate.toLocaleDateString('ru-RU')}</span>
                            </div>
                            ${c.hours_per_week ? `
                            <div class="detail-item">
                                <span class="detail-icon">‚è±Ô∏è</span>
                                <span>${c.hours_per_week} —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é</span>
                            </div>
                            ` : ''}
                            ${c.max_students ? `
                            <div class="detail-item">
                                <span class="detail-icon">üë•</span>
                                <span>${c.participant_count || 0} / ${c.max_students} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                            </div>
                            ` : ''}
                            ${c.certificate_available ? `
                            <div class="detail-item">
                                <span class="detail-icon">üìú</span>
                                <span>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏</span>
                            </div>
                            ` : ''}
                        </div>
                        ${buttonHtml}
                    </div>
                `;
            }).join('');
        }

        // Register for webinar
        async function registerForWebinar(webinarId) {
            try {
                const response = await fetch(`/api/webinars/${webinarId}/register`, {
                    method: 'POST'
                });
                const result = await response.json();
                if (response.ok) {
                    alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä!');
                    await loadWebinars();
                } else {
                    alert(result.detail || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Cancel webinar registration
        async function cancelWebinarRegistration(webinarId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä?')) {
                return;
            }
            try {
                const response = await fetch(`/api/webinars/${webinarId}/register`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (response.ok) {
                    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞');
                    await loadWebinars();
                } else {
                    alert(result.detail || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Register for course
        async function registerForCourse(courseId) {
            try {
                const response = await fetch(`/api/courses/${courseId}/register`, {
                    method: 'POST'
                });
                const result = await response.json();
                if (response.ok) {
                    alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫—É—Ä—Å!');
                    await loadCourses();
                } else {
                    alert(result.detail || '–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Cancel course registration
        async function cancelCourseRegistration(courseId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å?')) {
                return;
            }
            try {
                const response = await fetch(`/api/courses/${courseId}/register`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (response.ok) {
                    alert('–ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞');
                    await loadCourses();
                } else {
                    alert(result.detail || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Filter functionality
        const filterBtns = document.querySelectorAll('.filter-btn');
        const sections = document.querySelectorAll('.hackathons-section');

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons
                filterBtns.forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                btn.classList.add('active');

                // Hide all sections
                sections.forEach(section => {
                    section.style.display = 'none';
                });

                // Show selected section
                const filter = btn.getAttribute('data-filter');
                const targetSection = document.getElementById(filter);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    // Load data if needed
                    if (filter === 'webinars') {
                        loadWebinars();
                    } else if (filter === 'courses') {
                        loadCourses();
                    }
                    // Scroll to the section smoothly
                    setTimeout(() => {
                        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            });
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async () => {
            await loadUserData();
            await loadWebinars();
        });
    </script>
</body>
</html>

